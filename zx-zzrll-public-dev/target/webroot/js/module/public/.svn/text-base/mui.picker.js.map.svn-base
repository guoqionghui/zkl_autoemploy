{"version":3,"sources":["js/module/public/mui.picker.js"],"names":["$","window","document","undefined","MAX_EXCEED","VISIBLE_RANGE","DEFAULT_ITEM_HEIGHT","BLUR_WIDTH","rad2deg","rad","Math","PI","platform","deg2rad","deg","navigator","toLowerCase","userAgent","isIos","indexOf","Picker","holder","options","self","this","init","initInertiaParams","calcElementItemPostion","bindEvent","prototype","findElementItems","elementItems","slice","call","querySelectorAll","list","querySelector","height","offsetHeight","r","d","itemHeight","length","itemAngle","parseInt","calcAngle","hightlightRange","visibleRange","beginAngle","beginExceed","angle","style","webkitTransformOrigin","andGenerateItms","items","forEach","item","index","endAngle","webkitTransform","dataItem","text","innerHTML","value","getAttribute","push","endExceed","calcElementItemVisibility","c","a","b","parseFloat","abs","intDeg","cosC","angleC","acos","difference","classList","add","remove","setAngle","lastAngle","startY","isPicking","addEventListener","EVENT_START","event","preventDefault","webkitTransition","changedTouches","pageY","updateInertiaParams","EVENT_END","startInertiaScroll","EVENT_CANCEL","EVENT_MOVE","endY","dragRange","dragAngle","newAngle","elementItem","target","tagName","setSelectedIndex","lastMoveTime","lastMoveStart","stopInertiaMove","isStart","point","timeStamp","Date","now","startAngle","nowTime","v","dir","deceleration","duration","dist","distAngle","srcDistAngle","endScroll","scrollDistAngle","frameInterval","stepCount","stepIndex","inertiaMove","quartEaseOut","setTimeout","t","toFixed","triggerChange","force","getSelectedIndex","trigger","lastIndex","correctAngle","setItems","buffer","join","getItems","callback","getSelectedItem","getSelectedValue","getSelectedText","setSelectedValue","fn","picker","each","i","element","optionsText","_options","JSON","parse","ready","mui"],"mappings":"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","file":"js/module/public/mui.picker.js","sourcesContent":["/**\n * 选择列表插件\n * varstion 2.0.0\n * by Houfeng\n * Houfeng@DCloud.io\n */\n\n(function($, window, document, undefined) {\n\n\tvar MAX_EXCEED = 30;\n\tvar VISIBLE_RANGE = 90;\n\tvar DEFAULT_ITEM_HEIGHT = 40;\n\tvar BLUR_WIDTH = 10;\n\n\tvar rad2deg = $.rad2deg = function(rad) {\n\t\treturn rad / (Math.PI / 180);\n\t};\n\n\tvar deg2rad = $.deg2rad = function(deg) {\n\t\treturn deg * (Math.PI / 180);\n\t};\n\n\tvar platform = navigator.platform.toLowerCase();\n\tvar userAgent = navigator.userAgent.toLowerCase();\n\tvar isIos = (userAgent.indexOf('iphone') > -1 ||\n\t\t\tuserAgent.indexOf('ipad') > -1 ||\n\t\t\tuserAgent.indexOf('ipod') > -1) &&\n\t\t(platform.indexOf('iphone') > -1 ||\n\t\t\tplatform.indexOf('ipad') > -1 ||\n\t\t\tplatform.indexOf('ipod') > -1);\n\t//alert(isIos);\n\n\tvar Picker = $.Picker = function(holder, options) {\n\t\tvar self = this;\n\t\tself.holder = holder;\n\t\tself.options = options || {};\n\t\tself.init();\n\t\tself.initInertiaParams();\n\t\tself.calcElementItemPostion(true);\n\t\tself.bindEvent();\n\t};\n\n\tPicker.prototype.findElementItems = function() {\n\t\tvar self = this;\n\t\tself.elementItems = [].slice.call(self.holder.querySelectorAll('li'));\n\t\treturn self.elementItems;\n\t};\n\n\tPicker.prototype.init = function() {\n\t\tvar self = this;\n\t\tself.list = self.holder.querySelector('ul');\n\t\tself.findElementItems();\n\t\tself.height = self.holder.offsetHeight;\n\t\tself.r = self.height / 2 - BLUR_WIDTH;\n\t\tself.d = self.r * 2;\n\t\tself.itemHeight = self.elementItems.length > 0 ? self.elementItems[0].offsetHeight : DEFAULT_ITEM_HEIGHT;\n\t\tself.itemAngle = parseInt(self.calcAngle(self.itemHeight * 0.8));\n\t\tself.hightlightRange = self.itemAngle / 2;\n\t\tself.visibleRange = VISIBLE_RANGE;\n\t\tself.beginAngle = 0;\n\t\tself.beginExceed = self.beginAngle - MAX_EXCEED;\n\t\tself.list.angle = self.beginAngle;\n\t\tif (isIos) {\n\t\t\tself.list.style.webkitTransformOrigin = \"center center \" + self.r + \"px\";\n\t\t}\n\t};\n\n\tPicker.prototype.calcElementItemPostion = function(andGenerateItms) {\n\t\tvar self = this;\n\t\tif (andGenerateItms) {\n\t\t\tself.items = [];\n\t\t}\n\t\tself.elementItems.forEach(function(item) {\n\t\t\tvar index = self.elementItems.indexOf(item);\n\t\t\tself.endAngle = self.itemAngle * index;\n\t\t\titem.angle = self.endAngle;\n\t\t\titem.style.webkitTransformOrigin = \"center center -\" + self.r + \"px\";\n\t\t\titem.style.webkitTransform = \"translateZ(\" + self.r + \"px) rotateX(\" + (-self.endAngle) + \"deg)\";\n\t\t\tif (andGenerateItms) {\n\t\t\t\tvar dataItem = {};\n\t\t\t\tdataItem.text = item.innerHTML || '';\n\t\t\t\tdataItem.value = item.getAttribute('data-value') || dataItem.text;\n\t\t\t\tself.items.push(dataItem);\n\t\t\t}\n\t\t});\n\t\tself.endExceed = self.endAngle + MAX_EXCEED;\n\t\tself.calcElementItemVisibility(self.beginAngle);\n\t};\n\n\tPicker.prototype.calcAngle = function(c) {\n\t\tvar self = this;\n\t\tvar a = b = parseFloat(self.r);\n\t\t//直径的整倍数部分直接乘以 180\n\t\tc = Math.abs(c); //只算角度不关心正否值\n\t\tvar intDeg = parseInt(c / self.d) * 180;\n\t\tc = c % self.d;\n\t\t//余弦\n\t\tvar cosC = (a * a + b * b - c * c) / (2 * a * b);\n\t\tvar angleC = intDeg + rad2deg(Math.acos(cosC));\n\t\treturn angleC;\n\t};\n\n\tPicker.prototype.calcElementItemVisibility = function(angle) {\n\t\tvar self = this;\n\t\tself.elementItems.forEach(function(item) {\n\t\t\tvar difference = Math.abs(item.angle - angle);\n\t\t\tif (difference < self.hightlightRange) {\n\t\t\t\titem.classList.add('highlight');\n\t\t\t} else if (difference < self.visibleRange) {\n\t\t\t\titem.classList.add('visible');\n\t\t\t\titem.classList.remove('highlight');\n\t\t\t} else {\n\t\t\t\titem.classList.remove('highlight');\n\t\t\t\titem.classList.remove('visible');\n\t\t\t}\n\t\t});\n\t};\n\n\tPicker.prototype.setAngle = function(angle) {\n\t\tvar self = this;\n\t\tself.list.angle = angle;\n\t\tself.list.style.webkitTransform = \"perspective(1000px) rotateY(0deg) rotateX(\" + angle + \"deg)\";\n\t\tself.calcElementItemVisibility(angle);\n\t};\n\n\tPicker.prototype.bindEvent = function() {\n\t\tvar self = this;\n\t\tvar lastAngle = 0;\n\t\tvar startY = null;\n\t\tvar isPicking = false;\n\t\tself.holder.addEventListener($.EVENT_START, function(event) {\n\t\t\tisPicking = true;\n\t\t\tevent.preventDefault();\n\t\t\tself.list.style.webkitTransition = '';\n\t\t\tstartY = (event.changedTouches ? event.changedTouches[0] : event).pageY;\n\t\t\tlastAngle = self.list.angle;\n\t\t\tself.updateInertiaParams(event, true);\n\t\t}, false);\n\t\tself.holder.addEventListener($.EVENT_END, function(event) {\n\t\t\tisPicking = false;\n\t\t\tevent.preventDefault();\n\t\t\tself.startInertiaScroll(event);\n\t\t}, false);\n\t\tself.holder.addEventListener($.EVENT_CANCEL, function(event) {\n\t\t\tisPicking = false;\n\t\t\tevent.preventDefault();\n\t\t\tself.startInertiaScroll(event);\n\t\t}, false);\n\t\tself.holder.addEventListener($.EVENT_MOVE, function(event) {\n\t\t\tif (!isPicking) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tevent.preventDefault();\n\t\t\tvar endY = (event.changedTouches ? event.changedTouches[0] : event).pageY;\n\t\t\tvar dragRange = endY - startY;\n\t\t\tvar dragAngle = self.calcAngle(dragRange);\n\t\t\tvar newAngle = dragRange > 0 ? lastAngle - dragAngle : lastAngle + dragAngle;\n\t\t\tif (newAngle > self.endExceed) {\n\t\t\t\tnewAngle = self.endExceed\n\t\t\t}\n\t\t\tif (newAngle < self.beginExceed) {\n\t\t\t\tnewAngle = self.beginExceed\n\t\t\t}\n\t\t\tself.setAngle(newAngle);\n\t\t\tself.updateInertiaParams(event);\n\t\t}, false);\n\t\t//--\n\t\tself.list.addEventListener('tap', function(event) {\n\t\t\telementItem = event.target;\n\t\t\tif (elementItem.tagName == 'LI') {\n\t\t\t\tself.setSelectedIndex(self.elementItems.indexOf(elementItem), 200);\n\t\t\t}\n\t\t}, false);\n\t};\n\n\tPicker.prototype.initInertiaParams = function() {\n\t\tvar self = this;\n\t\tself.lastMoveTime = 0;\n\t\tself.lastMoveStart = 0;\n\t\tself.stopInertiaMove = false;\n\t};\n\n\tPicker.prototype.updateInertiaParams = function(event, isStart) {\n\t\tvar self = this;\n\t\tvar point = event.changedTouches ? event.changedTouches[0] : event;\n\t\tif (isStart) {\n\t\t\tself.lastMoveStart = point.pageY;\n\t\t\tself.lastMoveTime = event.timeStamp || Date.now();\n\t\t\tself.startAngle = self.list.angle;\n\t\t} else {\n\t\t\tvar nowTime = event.timeStamp || Date.now();\n\t\t\tif (nowTime - self.lastMoveTime > 300) {\n\t\t\t\tself.lastMoveTime = nowTime;\n\t\t\t\tself.lastMoveStart = point.pageY;\n\t\t\t}\n\t\t}\n\t\tself.stopInertiaMove = true;\n\t};\n\n\tPicker.prototype.startInertiaScroll = function(event) {\n\t\tvar self = this;\n\t\tvar point = event.changedTouches ? event.changedTouches[0] : event;\n\t\t/** \n\t\t * 缓动代码\n\t\t */\n\t\tvar nowTime = event.timeStamp || Date.now();\n\t\tvar v = (point.pageY - self.lastMoveStart) / (nowTime - self.lastMoveTime); //最后一段时间手指划动速度  \n\t\tvar dir = v > 0 ? -1 : 1; //加速度方向  \n\t\tvar deceleration = dir * 0.0006 * -1;\n\t\tvar duration = Math.abs(v / deceleration); // 速度消减至0所需时间  \n\t\tvar dist = v * duration / 2; //最终移动多少 \n\t\tvar startAngle = self.list.angle;\n\t\tvar distAngle = self.calcAngle(dist) * dir;\n\t\t//----\n\t\tvar srcDistAngle = distAngle;\n\t\tif (startAngle + distAngle < self.beginExceed) {\n\t\t\tdistAngle = self.beginExceed - startAngle;\n\t\t\tduration = duration * (distAngle / srcDistAngle) * 0.6;\n\t\t}\n\t\tif (startAngle + distAngle > self.endExceed) {\n\t\t\tdistAngle = self.endExceed - startAngle;\n\t\t\tduration = duration * (distAngle / srcDistAngle) * 0.6;\n\t\t}\n\t\t//----\n\t\tif (distAngle == 0) {\n\t\t\tself.endScroll();\n\t\t\treturn;\n\t\t}\n\t\tself.scrollDistAngle(nowTime, startAngle, distAngle, duration);\n\t};\n\n\tPicker.prototype.scrollDistAngle = function(nowTime, startAngle, distAngle, duration) {\n\t\tvar self = this;\n\t\tself.stopInertiaMove = false;\n\t\t(function(nowTime, startAngle, distAngle, duration) {\n\t\t\tvar frameInterval = 13;\n\t\t\tvar stepCount = duration / frameInterval;\n\t\t\tvar stepIndex = 0;\n\t\t\t(function inertiaMove() {\n\t\t\t\tif (self.stopInertiaMove) return;\n\t\t\t\tvar newAngle = self.quartEaseOut(stepIndex, startAngle, distAngle, stepCount);\n\t\t\t\tself.setAngle(newAngle);\n\t\t\t\tstepIndex++;\n\t\t\t\tif (stepIndex > stepCount - 1 || newAngle < self.beginExceed || newAngle > self.endExceed) {\n\t\t\t\t\tself.endScroll();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tsetTimeout(inertiaMove, frameInterval);\n\t\t\t})();\n\t\t})(nowTime, startAngle, distAngle, duration);\n\t};\n\n\tPicker.prototype.quartEaseOut = function(t, b, c, d) {\n\t\treturn -c * ((t = t / d - 1) * t * t * t - 1) + b;\n\t};\n\n\tPicker.prototype.endScroll = function() {\n\t\tvar self = this;\n\t\tif (self.list.angle < self.beginAngle) {\n\t\t\tself.list.style.webkitTransition = \"150ms ease-out\";\n\t\t\tself.setAngle(self.beginAngle);\n\t\t} else if (self.list.angle > self.endAngle) {\n\t\t\tself.list.style.webkitTransition = \"150ms ease-out\";\n\t\t\tself.setAngle(self.endAngle);\n\t\t} else {\n\t\t\tvar index = parseInt((self.list.angle / self.itemAngle).toFixed(0));\n\t\t\tself.list.style.webkitTransition = \"100ms ease-out\";\n\t\t\tself.setAngle(self.itemAngle * index);\n\t\t}\n\t\tself.triggerChange();\n\t};\n\n\tPicker.prototype.triggerChange = function(force) {\n\t\tvar self = this;\n\t\tsetTimeout(function() {\n\t\t\tvar index = self.getSelectedIndex();\n\t\t\tvar item = self.items[index];\n\t\t\tif ($.trigger && (index != self.lastIndex || force === true)) {\n\t\t\t\t$.trigger(self.holder, 'change', {\n\t\t\t\t\t\"index\": index,\n\t\t\t\t\t\"item\": item\n\t\t\t\t});\n\t\t\t\t//console.log('change:' + index);\n\t\t\t}\n\t\t\tself.lastIndex = index;\n\t\t\ttypeof force === 'function' && force();\n\t\t}, 0);\n\t};\n\n\tPicker.prototype.correctAngle = function(angle) {\n\t\tvar self = this;\n\t\tif (angle < self.beginAngle) {\n\t\t\treturn self.beginAngle;\n\t\t} else if (angle > self.endAngle) {\n\t\t\treturn self.endAngle;\n\t\t} else {\n\t\t\treturn angle;\n\t\t}\n\t};\n\n\tPicker.prototype.setItems = function(items) {\n\t\tvar self = this;\n\t\tself.items = items || [];\n\t\tvar buffer = [];\n\t\tself.items.forEach(function(item) {\n\t\t\tif (item !== null && item !== undefined) {\n\t\t\t\tbuffer.push('<li>' + (item.text || item) + '</li>');\n\t\t\t}\n\t\t});\n\t\tself.list.innerHTML = buffer.join('');\n\t\tself.findElementItems();\n\t\tself.calcElementItemPostion();\n\t\tself.setAngle(self.correctAngle(self.list.angle));\n\t\tself.triggerChange(true);\n\t};\n\n\tPicker.prototype.getItems = function() {\n\t\tvar self = this;\n\t\treturn self.items;\n\t};\n\n\tPicker.prototype.getSelectedIndex = function() {\n\t\tvar self = this;\n\t\treturn parseInt((self.list.angle / self.itemAngle).toFixed(0));\n\t};\n\n\tPicker.prototype.setSelectedIndex = function(index, duration, callback) {\n\t\tvar self = this;\n\t\tself.list.style.webkitTransition = '';\n\t\tvar angle = self.correctAngle(self.itemAngle * index);\n\t\tif (duration && duration > 0) {\n\t\t\tvar distAngle = angle - self.list.angle;\n\t\t\tself.scrollDistAngle(Date.now(), self.list.angle, distAngle, duration);\n\t\t} else {\n\t\t\tself.setAngle(angle);\n\t\t}\n\t\tself.triggerChange(callback);\n\t};\n\n\tPicker.prototype.getSelectedItem = function() {\n\t\tvar self = this;\n\t\treturn self.items[self.getSelectedIndex()];\n\t};\n\n\tPicker.prototype.getSelectedValue = function() {\n\t\tvar self = this;\n\t\treturn (self.items[self.getSelectedIndex()] || {}).value;\n\t};\n\n\tPicker.prototype.getSelectedText = function() {\n\t\tvar self = this;\n\t\treturn (self.items[self.getSelectedIndex()] || {}).text;\n\t};\n\n\tPicker.prototype.setSelectedValue = function(value, duration, callback) {\n\t\tvar self = this;\n\t\tfor (var index in self.items) {\n\t\t\tvar item = self.items[index];\n\t\t\tif (item.value == value) {\n\t\t\t\tself.setSelectedIndex(index, duration, callback);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t};\n\n\tif ($.fn) {\n\t\t$.fn.picker = function(options) {\n\t\t\t//遍历选择的元素\n\t\t\tthis.each(function(i, element) {\n\t\t\t\tif (element.picker) return;\n\t\t\t\tif (options) {\n\t\t\t\t\telement.picker = new Picker(element, options);\n\t\t\t\t} else {\n\t\t\t\t\tvar optionsText = element.getAttribute('data-picker-options');\n\t\t\t\t\tvar _options = optionsText ? JSON.parse(optionsText) : {};\n\t\t\t\t\telement.picker = new Picker(element, _options);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn this[0] ? this[0].picker : null;\n\t\t};\n\n\t\t//自动初始化\n\t\t$.ready(function() {\n\t\t\t$('.mui-picker').picker();\n\t\t});\n\t}\n\n})(window.mui || window, window, document, undefined);\n//end"],"sourceRoot":"/source/"}