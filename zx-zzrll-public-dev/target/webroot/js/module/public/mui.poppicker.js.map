{"version":3,"sources":["js/module/public/mui.poppicker.js"],"names":["$","document","dom","str","Array","length","slice","call","__create_dom_div__","createElement","innerHTML","childNodes","panelBuffer","pickerBuffer","PopPicker","Class","extend","init","options","self","this","buttons","panel","body","appendChild","ok","querySelector","cancel","mask","createMask","innerText","addEventListener","event","hide","callback","rs","getSelectedItems","_createPicker","EVENT_START","preventDefault","EVENT_MOVE","layer","width","pickers","i","pickerElement","style","picker","push","nextPickerElement","nextSibling","eventData","detail","preItem","item","setItems","children","setData","data","items","getSelectedItem","show","classList","add","className","__back","back","disposed","remove","close","dispose","setTimeout","parentNode","removeChild","name","mui"],"mappings":"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","file":"js/module/public/mui.poppicker.js","sourcesContent":["/**\n * 弹出选择列表插件\n * 此组件依赖 listpcker ，请在页面中先引入 mui.picker.css + mui.picker.js\n * varstion 1.0.1\n * by Houfeng\n * Houfeng@DCloud.io\n */\n\n(function($, document) {\n\n\t//创建 DOM\n\t$.dom = function(str) {\n\t\tif (typeof(str) !== 'string') {\n\t\t\tif ((str instanceof Array) || (str[0] && str.length)) {\n\t\t\t\treturn [].slice.call(str);\n\t\t\t} else {\n\t\t\t\treturn [str];\n\t\t\t}\n\t\t}\n\t\tif (!$.__create_dom_div__) {\n\t\t\t$.__create_dom_div__ = document.createElement('div');\n\t\t}\n\t\t$.__create_dom_div__.innerHTML = str;\n\t\treturn [].slice.call($.__create_dom_div__.childNodes);\n\t};\n\n\tvar panelBuffer = '<div class=\"mui-poppicker\">\\\n\t\t<div class=\"mui-poppicker-header\">\\\n\t\t\t<button class=\"mui-btn mui-poppicker-btn-cancel\">取消</button>\\\n\t\t\t<button class=\"mui-btn mui-btn-blue mui-poppicker-btn-ok\">确定</button>\\\n\t\t\t<div class=\"mui-poppicker-clear\"></div>\\\n\t\t</div>\\\n\t\t<div class=\"mui-poppicker-body\">\\\n\t\t</div>\\\n\t</div>';\n\n\tvar pickerBuffer = '<div class=\"mui-picker\">\\\n\t\t<div class=\"mui-picker-inner\">\\\n\t\t\t<div class=\"mui-pciker-rule mui-pciker-rule-ft\"></div>\\\n\t\t\t<ul class=\"mui-pciker-list\">\\\n\t\t\t</ul>\\\n\t\t\t<div class=\"mui-pciker-rule mui-pciker-rule-bg\"></div>\\\n\t\t</div>\\\n\t</div>';\n\n\t//定义弹出选择器类\n\tvar PopPicker = $.PopPicker = $.Class.extend({\n\t\t//构造函数\n\t\tinit: function(options) {\n\t\t\tvar self = this;\n\t\t\tself.options = options || {};\n\t\t\tself.options.buttons = self.options.buttons || ['取消', '确定'];\n\t\t\tself.panel = $.dom(panelBuffer)[0];\n\t\t\tdocument.body.appendChild(self.panel);\n\t\t\tself.ok = self.panel.querySelector('.mui-poppicker-btn-ok');\n\t\t\tself.cancel = self.panel.querySelector('.mui-poppicker-btn-cancel');\n\t\t\tself.body = self.panel.querySelector('.mui-poppicker-body');\n\t\t\tself.mask = $.createMask();\n\t\t\tself.cancel.innerText = self.options.buttons[0];\n\t\t\tself.ok.innerText = self.options.buttons[1];\n\t\t\tself.cancel.addEventListener('tap', function(event) {\n\t\t\t\tself.hide();\n\t\t\t}, false);\n\t\t\tself.ok.addEventListener('tap', function(event) {\n\t\t\t\tif (self.callback) {\n\t\t\t\t\tvar rs = self.callback(self.getSelectedItems());\n\t\t\t\t\tif (rs !== false) {\n\t\t\t\t\t\tself.hide();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, false);\n\t\t\tself.mask[0].addEventListener('tap', function() {\n\t\t\t\tself.hide();\n\t\t\t}, false);\n\t\t\tself._createPicker();\n\t\t\t//防止滚动穿透\n\t\t\tself.panel.addEventListener($.EVENT_START, function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}, false);\n\t\t\tself.panel.addEventListener($.EVENT_MOVE, function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}, false);\n\t\t},\n\t\t_createPicker: function() {\n\t\t\tvar self = this;\n\t\t\tvar layer = self.options.layer || 1;\n\t\t\tvar width = (100 / layer) + '%';\n\t\t\tself.pickers = [];\n\t\t\tfor (var i = 1; i <= layer; i++) {\n\t\t\t\tvar pickerElement = $.dom(pickerBuffer)[0];\n\t\t\t\tpickerElement.style.width = width;\n\t\t\t\tself.body.appendChild(pickerElement);\n\t\t\t\tvar picker = $(pickerElement).picker();\n\t\t\t\tself.pickers.push(picker);\n\t\t\t\tpickerElement.addEventListener('change', function(event) {\n\t\t\t\t\tvar nextPickerElement = this.nextSibling;\n\t\t\t\t\tif (nextPickerElement && nextPickerElement.picker) {\n\t\t\t\t\t\tvar eventData = event.detail || {};\n\t\t\t\t\t\tvar preItem = eventData.item || {};\n\t\t\t\t\t\tnextPickerElement.picker.setItems(preItem.children);\n\t\t\t\t\t}\n\t\t\t\t}, false);\n\t\t\t}\n\t\t},\n\t\t//填充数据\n\t\tsetData: function(data) {\n\t\t\tvar self = this;\n\t\t\tdata = data || [];\n\t\t\tself.pickers[0].setItems(data);\n\t\t},\n\t\t//获取选中的项（数组）\n\t\tgetSelectedItems: function() {\n\t\t\tvar self = this;\n\t\t\tvar items = [];\n\t\t\tfor (var i in self.pickers) {\n\t\t\t\tvar picker = self.pickers[i];\n\t\t\t\titems.push(picker.getSelectedItem() || {});\n\t\t\t}\n\t\t\treturn items;\n\t\t},\n\t\t//显示\n\t\tshow: function(callback) {\n\t\t\tvar self = this;\n\t\t\tself.callback = callback;\n\t\t\tself.mask.show();\n\t\t\tdocument.body.classList.add($.className('poppicker-active-for-page'));\n\t\t\tself.panel.classList.add($.className('active'));\n\t\t\t//处理物理返回键\n\t\t\tself.__back = $.back;\n\t\t\t$.back = function() {\n\t\t\t\tself.hide();\n\t\t\t};\n\t\t},\n\t\t//隐藏\n\t\thide: function() {\n\t\t\tvar self = this;\n\t\t\tif (self.disposed) return;\n\t\t\tself.panel.classList.remove($.className('active'));\n\t\t\tself.mask.close();\n\t\t\tdocument.body.classList.remove($.className('poppicker-active-for-page'));\n\t\t\t//处理物理返回键\n\t\t\t$.back=self.__back;\n\t\t},\n\t\tdispose: function() {\n\t\t\tvar self = this;\n\t\t\tself.hide();\n\t\t\tsetTimeout(function() {\n\t\t\t\tself.panel.parentNode.removeChild(self.panel);\n\t\t\t\tfor (var name in self) {\n\t\t\t\t\tself[name] = null;\n\t\t\t\t\tdelete self[name];\n\t\t\t\t};\n\t\t\t\tself.disposed = true;\n\t\t\t}, 300);\n\t\t}\n\t});\n\n})(mui, document);"],"sourceRoot":"/source/"}